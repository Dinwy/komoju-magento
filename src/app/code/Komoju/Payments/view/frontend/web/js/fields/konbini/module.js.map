{
  "version": 3,
  "sources": ["../../../src/shared/validation.ts", "../../../src/shared/radio-helpers.ts", "../../../src/shared/translations.ts", "../../../src/fields/konbini/i18n.ts", "../../../src/fields/konbini/module.ts"],
  "sourcesContent": ["// Adds validation to an input element.\nexport function addValidation<Translations extends I18n>(\n  _i18n: Translations, // Used only by typescript to compile-time catch missing translations.\n  input: HTMLInputElement,\n  callback: (input: HTMLInputElement) => keyof Translations['en'] | null\n) {\n  // Add a class so that we know this input has validation.\n  input.classList.add('has-validation');\n\n  // Tiny detail: if the user has never inputted anything, we don't want to run validations at all\n  // at the risk of showing an error message when the user is just clicking around.\n  input.addEventListener('input', () => {\n    input.dataset.validationDirty = 'true';\n  });\n\n  // Validation function. This will be called on 'blur' and also on a custom 'validate' event.\n  const validate = (event: Event) => {\n    const input = event.target as HTMLInputElement;\n\n    const errorMessageKey = callback(input);\n\n    if (errorMessageKey) {\n      showError(_i18n, input, errorMessageKey);\n    }\n  };\n  input.addEventListener('blur', (event) => {\n    if (input.dataset.validationDirty !== 'true') return;\n    else return validate(event);\n  });\n  input.addEventListener('validate', validate);\n\n  // When the user focuses on the input, remove all error artifacts.\n  input.addEventListener('focus', (event) => {\n    const input = event.target as HTMLInputElement;\n    clearErrors(input);\n  });\n}\n\nexport function showError<Translations extends I18n>(\n  _i18n: Translations, // Used only by typescript to compile-time catch missing translations.\n  input: HTMLInputElement,\n  messageKey: keyof Translations['en']\n) {\n  input.classList.add('invalid');\n  const key = messageKey as string;\n\n  // We don't want to show the same error twice!\n  const container = input.parentElement;\n  const dupeSelector = `komoju-error:not(.removing) > komoju-i18n[key=\"${key}\"]`;\n  if (container?.querySelector(dupeSelector)) {\n    return;\n  }\n\n  container?.append(createErrorElement(messageKey as string));\n}\n\nexport function clearErrors(input: HTMLInputElement) {\n  input.classList.remove('invalid');\n  input.parentElement?.querySelectorAll('komoju-error:not(.removing)').forEach((element) => {\n    element.remove();\n  });\n}\n\n// Runs validations on an <input> element.\nexport function runValidation(input: HTMLInputElement) {\n  // Fire the 'validate' custom event.\n  input.dispatchEvent(new CustomEvent('validate'));\n\n  // If there's an error message, return it.\n  const errorMessage = input.parentElement?.querySelector('komoju-error:not(.removing)')?.textContent;\n  return errorMessage ?? null;\n}\n\n// Creates the error message element that appears under an invalid input.\n// Mainly just called by addValidation().\nexport function createErrorElement(messageKey: string) {\n  const el = window.document.createElement('komoju-error');\n  const i18nEl = window.document.createElement('komoju-i18n') as KomojuI18nElement;\n  i18nEl.key = messageKey;\n  el.appendChild(i18nEl);\n  return el;\n}\n", "interface QuerySelectorAll {\n  querySelectorAll: HTMLElement['querySelectorAll']\n}\n\n// Add .checked to the parent .radio element when the input is checked.\n// This is just to make the CSS a little easier, since we're putting the\n// input inside of the label.\nexport function setupRadioParentCheckedClass(input: HTMLInputElement, root: QuerySelectorAll) {\n  // Some sanity checks\n  if (!input.parentElement) {\n    throw new Error('KOMOJU Fields bug: radio input has no parent');\n  }\n  if (!input.parentElement.classList.contains('radio')) {\n    throw new Error('KOMOJU Fields bug: radio input parent has no .radio class');\n  }\n\n  // Initialize the checked class\n  if (input.checked) {\n    input.parentElement.classList.add('checked');\n  }\n\n  // Set checked class then checked\n  input.addEventListener('change', () => {\n    root.querySelectorAll('.radio.checked').forEach((el) => el.classList.remove('checked'));\n    input.parentElement!.classList.add('checked');\n  });\n}\n", "declare let window: WindowWithKomojuGlobals;\n\n// Call this to add messages to the registry.\n// Individual payment method modules can do this to add their own messages.\n// That way, we avoid needing to load all messages for every payment method upfront.\nexport function registerMessages(messages: I18n) {\n  if (!window.komojuTranslations) {\n    window.komojuTranslations = { 'en': {}, 'ja': {} };\n  }\n\n  for (const lang of Object.keys(window.komojuTranslations)) {\n    window.komojuTranslations[lang] = {\n      ...window.komojuTranslations[lang],\n      ...messages[lang],\n    };\n  }\n}\n", "export const en = {\n  'kb.label.name': 'Name (shown on receipt)',\n  'kb.label.email': 'Email address',\n  'kb.error.required': 'Required',\n  'kb.store.daily-yamazaki': 'Daily Yamazaki',\n  'kb.store.family-mart': 'FamilyMart',\n  'kb.store.lawson': 'Lawson',\n  'kb.store.ministop': 'Ministop',\n  'kb.store.seicomart': 'Seicomart',\n  'kb.store.seven-eleven': 'Seven Eleven',\n};\n\nexport const ja: typeof en = {\n  'kb.label.name': '\u6C0F\u540D\uFF08\u30EC\u30B7\u30FC\u30C8\u3067\u8868\u793A\u3055\u308C\u307E\u3059\uFF09',\n  'kb.label.email': '\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9',\n  'kb.error.required': '\u5FC5\u9808\u9805\u76EE\u3067\u3059',\n  'kb.store.daily-yamazaki': '\u30C7\u30A4\u30EA\u30FC\u30E4\u30DE\u30B6\u30AD',\n  'kb.store.family-mart': '\u30D5\u30A1\u30DF\u30EA\u30FC\u30DE\u30FC\u30C8',\n  'kb.store.lawson': '\u30ED\u30FC\u30BD\u30F3',\n  'kb.store.ministop': '\u30DF\u30CB\u30B9\u30C8\u30C3\u30D7',\n  'kb.store.seicomart': '\u30BB\u30A4\u30B3\u30FC\u30DE\u30FC\u30C8',\n  'kb.store.seven-eleven': '\u30BB\u30D6\u30F3\u30A4\u30EC\u30D6\u30F3',\n};\n", "import '../../types.d';\n// @ts-ignore\nimport html from './template.html'\nimport { addValidation } from '../../shared/validation';\nimport { setupRadioParentCheckedClass } from '../../shared/radio-helpers';\n\nimport { registerMessages } from '../../shared/translations';\nimport * as i18n from './i18n';\nregisterMessages(i18n);\n\nexport const render: KomojuRenderFunction = (root, paymentMethod) => {\n  root.innerHTML = html;\n  initializeInputs(root as KomojuFieldsConfig, paymentMethod as KomojuKonbiniPaymentMethod);\n}\n\nexport const paymentDetails: KomojuPaymentDetailsFunction = (root, _paymentMethod) => {\n  const name = root.querySelector('#kb-name')! as HTMLInputElement;\n  const email = root.querySelector('#kb-email')! as HTMLInputElement;\n  const store = root.querySelector('input[name=\"kb-store\"]:checked')! as HTMLInputElement;\n\n  return {\n    type: 'konbini',\n    store: store.value,\n    email: email.value,\n    name: name.value,\n  }\n}\n\nfunction initializeInputs(\n  root: KomojuFieldsConfig,\n  paymentMethod: KomojuKonbiniPaymentMethod\n) {\n  const radioTemplate = root.querySelector('#konbini-radio')! as HTMLTemplateElement;\n  const email = root.querySelector('#kb-email')! as HTMLInputElement;\n  \n  let checked = false;\n  for (const brand in paymentMethod.brands) {\n    const element = radioTemplate.content.cloneNode(true) as HTMLElement;\n    const input = element.querySelector('input') as HTMLInputElement;\n    const image = element.querySelector('img') as HTMLImageElement;\n    const label = element.querySelector('komoju-i18n') as KomojuI18nElement;\n\n    input.value = brand;\n    if (!checked) {\n      input.checked = true;\n      checked = true;\n    }\n    setupRadioParentCheckedClass(input, root);\n\n    image.src = `${root.komojuApi}${paymentMethod.brands[brand].icon}`;\n    label.key = `kb.store.${brand}`;\n\n    radioTemplate.parentElement!.appendChild(element);\n  }\n\n  addValidation(i18n, email, (input) => {\n    if (input.value === '') return 'kb.error.required';\n    return null;\n  });\n}\n"],
  "mappings": "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",
  "names": ["input"]
}
